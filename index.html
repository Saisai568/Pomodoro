<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZEN FOCUS | Cyberpunk Timer</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

        :root {
            --neon-blue: #00f3ff;
            --neon-purple: #bc13fe;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-color: #e0e0e0;
        }

        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Share Tech Mono', monospace;
            background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e, #141E30);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: var(--text-color);
            overflow: hidden;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            text-align: center;
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            padding: 3rem 4rem;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            /* 放大容器：視窗 90% 或最大 760px */
            width: min(90vw, 760px);
            max-width: 760px;
            position: relative;
        }

        .container::before {
            content: '';
            position: absolute;
            top: -2px; left: -2px; right: -2px; bottom: -2px;
            background: linear-gradient(45deg, var(--neon-blue), transparent, var(--neon-purple));
            z-index: -1;
            border-radius: 22px;
            opacity: 0.3;
        }

        h1 {
            font-size: 1.4rem;
            letter-spacing: 4px;
            margin-bottom: 2rem;
            text-transform: uppercase;
            color: rgba(255,255,255,0.7);
        }

        .timer-display {
            font-size: 6.5rem;
            margin: 1.5rem 0;
            text-shadow: 0 0 20px rgba(0, 243, 255, 0.5);
            font-variant-numeric: tabular-nums;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
        }

        button {
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--text-color);
            padding: 12px 24px;
            font-family: 'Share Tech Mono', monospace;
            font-size: 1.05rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 8px;
            flex: 1;
            text-transform: uppercase;
        }

        button:hover {
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 15px var(--neon-blue);
            border-color: var(--neon-blue);
            text-shadow: 0 0 5px var(--neon-blue);
        }

        button.reset:hover {
            box-shadow: 0 0 15px var(--neon-purple);
            border-color: var(--neon-purple);
            text-shadow: 0 0 5px var(--neon-purple);
        }

        .status {
            margin-top: 1rem;
            font-size: 0.8rem;
            opacity: 0.6;
            height: 1rem;
        }

        /* Session Dots */
        .sessions {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 1.5rem;
            height: 12px;
        }

        .session-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .session-dot.active {
            background: var(--neon-blue);
            box-shadow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue);
        }

        /* Glitch Effect */
        .glitch {
            position: relative;
        }

        .glitch::before,
        .glitch::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--glass-bg);
        }

        .glitch::before {
            left: 2px;
            text-shadow: -1px 0 #ff00c1;
            clip: rect(44px, 450px, 56px, 0);
            animation: glitch-anim 5s infinite linear alternate-reverse;
        }

        .glitch::after {
            left: -2px;
            text-shadow: -1px 0 #00fff9;
            clip: rect(44px, 450px, 56px, 0);
            animation: glitch-anim2 5s infinite linear alternate-reverse;
        }

        @keyframes glitch-anim {
            0% { clip: rect(31px, 9999px, 94px, 0); }
            4.166666667% { clip: rect(91px, 9999px, 43px, 0); }
            8.333333333% { clip: rect(65px, 9999px, 59px, 0); }
            12.5% { clip: rect(98px, 9999px, 96px, 0); }
            16.66666667% { clip: rect(6px, 9999px, 3px, 0); }
            20.83333333% { clip: rect(43px, 9999px, 82px, 0); }
            25% { clip: rect(46px, 9999px, 14px, 0); }
            29.16666667% { clip: rect(93px, 9999px, 23px, 0); }
            33.33333333% { clip: rect(6px, 9999px, 66px, 0); }
            37.5% { clip: rect(2px, 9999px, 92px, 0); }
            41.66666667% { clip: rect(84px, 9999px, 10px, 0); }
            45.83333333% { clip: rect(53px, 9999px, 94px, 0); }
            50% { clip: rect(24px, 9999px, 8px, 0); }
            54.16666667% { clip: rect(68px, 9999px, 4px, 0); }
            58.33333333% { clip: rect(95px, 9999px, 38px, 0); }
            62.5% { clip: rect(46px, 9999px, 64px, 0); }
            66.66666667% { clip: rect(2px, 9999px, 2px, 0); }
            70.83333333% { clip: rect(74px, 9999px, 57px, 0); }
            75% { clip: rect(63px, 9999px, 84px, 0); }
            79.16666667% { clip: rect(35px, 9999px, 53px, 0); }
            83.33333333% { clip: rect(20px, 9999px, 40px, 0); }
            87.5% { clip: rect(7px, 9999px, 24px, 0); }
            91.66666667% { clip: rect(60px, 9999px, 18px, 0); }
            95.83333333% { clip: rect(37px, 9999px, 65px, 0); }
            100% { clip: rect(67px, 9999px, 88px, 0); }
        }

        @keyframes glitch-anim2 {
            0% { clip: rect(65px, 9999px, 100px, 0); }
            100% { clip: rect(10px, 9999px, 85px, 0); }
        }

    </style>
</head>
<body>

    <div class="container">
        <h1>Focus Mode</h1>
        <div class="sessions" id="sessions">
            <!-- Dots will be added here -->
        </div>
        <div class="timer-display" id="timer" data-text="25:00">25:00</div>
        
        <div class="controls">
            <button id="startBtn" onclick="startTimer()">Start</button>
            <button id="pauseBtn" onclick="pauseTimer()">Pause</button>
            <button id="nextBtn" onclick="nextSession()" style="display: none;">Next</button>
            <button class="reset" onclick="resetTimer()">Reset</button>
        </div>
        <div class="status" id="statusText">READY</div>
    </div>

    <script>
        let timeLeft = 25 * 60; // 25 minutes in seconds
        let timerId = null;
        let isWorkTime = true;
        let completedSessions = 0;
        const timerDisplay = document.getElementById('timer');
        const statusText = document.getElementById('statusText');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const nextBtn = document.getElementById('nextBtn');
        const sessionsContainer = document.getElementById('sessions');

        // Audio Context
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playTone(freq, type, duration, vol = 0.1) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function playClick() {
            playTone(1200, 'sine', 0.05, 0.05);
        }

        function playStart() {
            playTone(440, 'sine', 0.1);
            setTimeout(() => playTone(880, 'square', 0.3, 0.05), 100);
        }

        function playAlarm() {
            const now = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(440, now);
            osc.frequency.linearRampToValueAtTime(880, now + 0.5);
            osc.frequency.linearRampToValueAtTime(440, now + 1.0);
            
            gain.gain.setValueAtTime(0.2, now);
            gain.gain.linearRampToValueAtTime(0, now + 1.0);
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(now + 1.0);
        }

        function updateSessions() {
            sessionsContainer.innerHTML = '';
            // Show up to 4 dots, then maybe reset or just keep adding? Let's show 4 max for design
            for (let i = 0; i < 4; i++) {
                const dot = document.createElement('div');
                dot.className = 'session-dot';
                if (i < completedSessions % 5) { // Cycle every 4 sessions (actually 5th is long break usually, but let's keep simple)
                     if (i < completedSessions) dot.classList.add('active');
                }
                sessionsContainer.appendChild(dot);
            }
        }

        function updateDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const displayString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            timerDisplay.textContent = displayString;
            timerDisplay.setAttribute('data-text', displayString); // For glitch effect
            document.title = `${displayString} - Zen Focus`;
            
            // Random glitch effect when running
            if (timerId && Math.random() > 0.95) {
                timerDisplay.classList.add('glitch');
                setTimeout(() => timerDisplay.classList.remove('glitch'), 200);
            }
        }

        function updateTheme() {
            const root = document.documentElement;
            if (isWorkTime) {
                root.style.setProperty('--neon-blue', '#00f3ff');
                root.style.setProperty('--neon-purple', '#bc13fe');
                document.body.style.backgroundImage = 'linear-gradient(-45deg, #0f0c29, #302b63, #24243e, #141E30)';
            } else {
                root.style.setProperty('--neon-blue', '#4ade80');
                root.style.setProperty('--neon-purple', '#2dd4bf');
                document.body.style.backgroundImage = 'linear-gradient(-45deg, #134e5e, #71b280, #2c5364, #203a43)';
            }
        }

        function startTimer() {
            if (timerId) return;
            playStart();
            
            startBtn.style.display = "none";
            pauseBtn.style.display = "inline-block";
            nextBtn.style.display = "inline-block";
            updateTheme();

            if (isWorkTime) {
                statusText.textContent = "FOCUSING...";
            } else {
                statusText.textContent = "BREAK TIME";
            }
            statusText.style.color = "var(--neon-blue)";
            
            timerId = setInterval(() => {
                timeLeft--;
                updateDisplay();

                if (timeLeft <= 0) {
                    clearInterval(timerId);
                    timerId = null;
                    
                    if (isWorkTime) {
                        completedSessions++;
                        updateSessions();
                    }

                    statusText.textContent = "SESSION COMPLETE";
                    statusText.style.color = "var(--neon-purple)";
                    playAlarm();
                    flashScreen();
                    alert("Time is up!");
                }
            }, 1000);
        }

        function pauseTimer() {
            playClick();
            clearInterval(timerId);
            timerId = null;
            startBtn.style.display = "inline-block";
            pauseBtn.style.display = "none";
            statusText.textContent = "PAUSED";
            statusText.style.color = "#e0e0e0";
            timerDisplay.classList.add('glitch'); // Glitch on pause
        }

        function resetTimer() {
            playClick();
            pauseTimer();
            isWorkTime = true;
            updateTheme();
            timeLeft = 25 * 60;
            completedSessions = 0;
            updateSessions();
            updateDisplay();
            statusText.textContent = "READY";
            statusText.style.color = "#e0e0e0";
            document.title = "ZEN FOCUS | Cyberpunk Timer";
            nextBtn.style.display = "none";
            timerDisplay.classList.remove('glitch');
        }

        function nextSession() {
            playClick();
            const nextMode = isWorkTime ? "Break" : "Focus";
            if (!confirm(`Ready to switch to ${nextMode} mode?`)) return;

            clearInterval(timerId);
            timerId = null;
            
            // If skipping work, do we count it? Maybe not.
            // But if skipping break, we just go to work.
            
            isWorkTime = !isWorkTime;
            
            if (isWorkTime) {
                timeLeft = 25 * 60;
            } else {
                timeLeft = 5 * 60;
            }
            updateDisplay();
            startTimer();
        }

        function flashScreen() {
            document.body.style.background = "var(--neon-purple)";
            setTimeout(() => {
                document.body.style.background = "";
                updateTheme(); // Restore theme background
            }, 500);
        }

        // Initialize
        updateSessions();
        updateDisplay();
        pauseBtn.style.display = "none";
    </script>
</body>
</html>